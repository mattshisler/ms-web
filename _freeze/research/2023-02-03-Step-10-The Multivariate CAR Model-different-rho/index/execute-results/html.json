{
  "hash": "6fba73402a5385affcea6433b7a6bba8",
  "result": {
    "markdown": "---\ntitle: \"Step 10 - The multivariate CAR model with DIFFERENT strengths of spatial correlation\"\ndescription: \"We explore extensions of the univariate CAR model described in Hierarchical Modeling and Analysis for Spatial data.\"\nauthor:\n  - name: Matthew Shisler\n    affiliation: North Carloina State University - Department of Statistics\n    affiliation-url: https://statistics.sciences.ncsu.edu/ \ncategories: [Bayesian, MCMC, Spatial, CAR] # self-defined categories\ndraft: false \nformat:\n  html: \n    code-fold: true\nexecute: \n  cache: false\n  freeze: auto\n---\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Code: Load the packages\"}\nlibrary(tidyverse)\nlibrary(igraph)\nlibrary(viridis)\n```\n:::\n\n\n## Intro\n\nWe explored the multivariate CAR model is the previous post finishing with a simulation of data from the proper version of the model where the scalar parameter controlling the strength of spatial correlation, $\\rho$ was common across elements of the multivariate response vector. This assumption may not always be reasonable. Here we will summarize one approach to introducing $p-1$ additional scalar parameters for a total of $p$ \"strength of spatial correlation\" parameters, one for each element of the multivariate response.\n\nConsider a spatial domain $\\mathcal{D} \\in \\mathbb{R}^2$ that is partitioned into $n$ areal units. The structure of the spatial domain is captured in the neighborhood matrix. Recall our definition of a neighborhood matrix $\\mathbf{W} = \\{w_{ij}\\}$, where\n$$\nw_{ij} = \n\\begin{cases}\n1 \\quad \\text{if} \\quad j \\in \\mathcal{N}(i),\\\\\n0 \\quad \\text{otherwise}.\n\\end{cases}\n$$\nand by convention $w_{ii}=0$. Further, define $w_{i+} = \\sum_{j=1}^pw_{ij}$, i.e. the number of neighbors of location $i$, $|\\mathcal{N}(i)|$.\n\nIn the univariate case we specified a spatial random effect $\\boldsymbol\\phi = (\\phi_1,\\dots,\\phi_n)$ meant to characterize spatial dependence. In the multivariate case, say of dimension $p$, we specify a $p \\times 1$ spatial random vector $\\boldsymbol\\phi_i = (\\phi_{i1}, \\phi_{i2},\\dots, \\phi_{ip})$ at each location $i$, $i = 1,\\dots,n$. Arrange these vectors as rows in a matrix $\\boldsymbol\\Phi$\n$$\n\\boldsymbol\\Phi = \n\\begin{pmatrix}\n\\boldsymbol\\phi_{1}\\\\\n\\boldsymbol\\phi_2\\\\\n\\vdots\\\\\n\\boldsymbol\\phi_n\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\phi_{11} & \\phi_{12} & \\dots & \\phi_{1p}\\\\\n\\phi_{21} & \\phi_{22} & \\dots & \\phi_{2p}\\\\\n\\vdots & \\vdots & \\ddots & \\vdots\\\\\n\\phi_{n1} & \\phi_{n2} & \\dots & \\phi_{np}\\\\\n\\end{pmatrix}.\n$$\n\nDefine $\\boldsymbol\\phi' = \\text{vec}(\\boldsymbol\\Phi^T)$, i.e. stacked columns of $\\boldsymbol\\Phi^T$. Here we will use $\\boldsymbol\\phi' = \\text{vec}(\\boldsymbol\\Phi^T)$ to characterize spatial dependence. From the previous post, the proper joint distribution of $\\boldsymbol\\phi'$ was\n\n$$\n\\boldsymbol\\phi'|\\boldsymbol\\Lambda \\sim N\\left(\\boldsymbol 0, (\\mathbf{D} - \\rho\\mathbf{W})^{-1} \\otimes \\boldsymbol\\Lambda\\right).\n$$\nwhere $\\mathbf{W}$ is the neighborhood matrix and $\\mathbf{D}$, the diagonal matrix of its row sums, $\\rho$ is the scalar strength of spatial correlation parameter, and $\\boldsymbol\\Lambda$ is the within-location covariance.\n\nOur goal is to re-specify this model to allow for different $\\rho_k$, $k = 1,\\dots,p$. One approach requires a re-arrangement of $\\boldsymbol\\phi$. Where previously $\\boldsymbol\\phi$ stacked $n$ vectors of length $p$ on top of each other, now consider $\\boldsymbol\\phi'$ to stack $p$ vectors of length $n$. That is we collect the $n$ instances of the $p$-th element of $\\boldsymbol\\phi_i$, $i=1,\\dots,n$. This operation is essentially transforming the vectorization of the $n \\times p$ matrix $\\boldsymbol\\Phi$ from the vectorization of its transpose and is accomplished via a *commutation* matrix.\n\nWe can commute $\\boldsymbol\\phi' = \\text{vec}(\\Phi^T)$ by applying the commutation matrix $\\mathbf{K}^{(p,n)}$ for the result $\\mathbf{K}^{(p,n)}\\text{vec}(\\Phi^T) = \\text{vec}(\\Phi)$. Given that\n\n$$\n\\text{vec}(\\boldsymbol\\Phi^T) = \\boldsymbol\\phi' \\sim N\\left(\\boldsymbol 0, (\\mathbf{D}-\\rho\\mathbf{W})^{-1} \\otimes \\boldsymbol\\Lambda\\right)\n$$\n\nthen the result of left multiplying by the commutation matrix yields a multivariate distribution with mean $\\boldsymbol 0$ and covariance matrix\n$$\n\\begin{align*}\n\\text{Cov}(\\mathbf{K}^{(p,n)}\\boldsymbol\\phi')&= \\mathbf{K}^{(p,n)}\\text{Cov}(\\boldsymbol\\phi')\\left(\\mathbf{K}^{(p,n)}\\right)^T\\\\\n&= \\mathbf{K}^{(p,n)}\\left[(\\mathbf{D}-\\rho\\mathbf{W})^{-1} \\otimes \\boldsymbol\\Lambda\\right]\\left(\\mathbf{K}^{(p,n)}\\right)^T \\\\\n&=\\mathbf{K}^{(p,n)}\\left[(\\mathbf{D}-\\rho\\mathbf{W})^{-1} \\otimes \\boldsymbol\\Lambda\\right]\\mathbf{K}^{(n,p)}\\\\\n&=\\boldsymbol\\Lambda \\otimes(\\mathbf{D}-\\rho\\mathbf{W})^{-1}\n\\end{align*}\n$$\nThe effect is that the Kronecker product in the covariance is commuted. Then when resulting Kronecker product is expanded, the scalar elements of the common non-spatial covariance matrix $\\Lambda$ are multiplied with blocks $(\\mathbf{D}-\\rho\\mathbf{W})$. It is in this form that we can introduce different $\\rho_k$ for each of the $p$ elements. \n\nThis allows us to \"break up\" elements of $\\Sigma$ and associate them with difference values of $\\rho_k$.\n$$\n\\boldsymbol\\Lambda \\otimes(\\mathbf{D}-\\rho\\mathbf{W})^{-1} =\n\\begin{pmatrix}\n\\lambda_{11} (\\mathbf{D}-\\rho\\mathbf{W})^{-1} & \\lambda_{12}(\\mathbf{D}-\\rho\\mathbf{W})^{-1} & \\dots & \\lambda_{1p}(\\mathbf{D}-\\rho\\mathbf{W})^{-1} \\\\\n\\lambda_{21} (\\mathbf{D}-\\rho\\mathbf{W})^{-1} & \\lambda_{22}(\\mathbf{D}-\\rho\\mathbf{W})^{-1} & \\dots & \\lambda_{2p}(\\mathbf{D}-\\rho\\mathbf{W})^{-1} \\\\\n\\vdots & \\vdots & \\ddots & \\vdots\\\\\n\\lambda_{p1} (\\mathbf{D}-\\rho\\mathbf{W})^{-1} & \\lambda_{p2}(\\mathbf{D}-\\rho\\mathbf{W})^{-1} & \\dots & \\lambda_{pp}(\\mathbf{D}-\\rho\\mathbf{W})^{-1} \\\\\n\\end{pmatrix}\n$$\n\nwhere $\\lambda_{ij}$ are the scalar elements of $\\boldsymbol\\Lambda$.\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}